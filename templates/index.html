<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°–ø–∏—Å–æ–∫ —ñ–Ω–≤–µ—Ä—Ç–æ—Ä—ñ–≤</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <div class="container my-4">
    <h1 class="text-center mb-4">–°–ø–∏—Å–æ–∫ —ñ–Ω–≤–µ—Ä—Ç–æ—Ä—ñ–≤</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="–ó–∞–∫—Ä–∏—Ç–∏"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="GET" class="mb-3">
      <label for="group">–§—ñ–ª—å—Ç—Ä –∑–∞ –≥—Ä—É–ø–æ—é:</label>
      <select name="group" onchange="this.form.submit()" class="form-select w-auto d-inline-block ms-2">
        <option value="">–£—Å—ñ –≥—Ä—É–ø–∏</option>
        {% for g in groups %}
          <option value="{{ g }}" {% if selected_group == g %}selected{% endif %}>{{ g }}</option>
        {% endfor %}
      </select>
    </form>

    <form method="POST" action="/control">
      {% if inverters %}
        <div class="row justify-content-center">
          <div class="col-12 col-md-10">
            <div class="table-responsive">
              <table class="table table-bordered table-hover align-middle">
                <thead class="table-light">
                  <tr>
                    <th></th>
                    <th>–ù–∞–∑–≤–∞</th>
                    <th>–ì—Ä—É–ø–∞</th>
                    <th>IP-–∞–¥—Ä–µ—Å–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                  </tr>
                </thead>
                <tbody>
                  {% for inverter in inverters %}
                  <tr>
                    <td><input type="checkbox" name="selected_ids" value="{{ inverter.id }}"></td>
                    <td><a href="{{ url_for('edit_inverter', inverter_id=inverter.id) }}">{{ inverter.name }}</a></td>
                    <td>{{ inverter.group }}</td>
                    <td>{{ inverter.ip_address }}</td>
                    <td>
  {% if inverter.is_online %}
    <span class="badge bg-success">–û–Ω–ª–∞–π–Ω</span>
  {% else %}
    <span class="badge bg-secondary">–û—Ñ–ª–∞–π–Ω</span>
  {% endif %}
</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div id="actions" class="text-center mt-3" style="display: none;">
          <button type="submit" name="action" value="on" class="btn btn-success me-2">üîå –£–≤—ñ–º–∫–Ω—É—Ç–∏</button>
          <button type="submit" name="action" value="off" class="btn btn-danger me-2">‚õî –í–∏–º–∫–Ω—É—Ç–∏</button>
          <button type="submit" name="action" value="limit" class="btn btn-warning me-2">‚ö° –û–±–º–µ–∂–∏—Ç–∏ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å</button>
          <button type="submit" name="action" value="test" class="btn btn-info me-2">üîç –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è</button>
          <button type="submit" name="action" value="delete" onclick="return confirm('‚ö†Ô∏è –í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤–∏–±—Ä–∞–Ω—ñ —ñ–Ω–≤–µ—Ä—Ç–æ—Ä–∏?');" class="btn btn-outline-danger">
            üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏
          </button>
        </div>
      {% else %}
        <p class="text-center">–Ü–Ω–≤–µ—Ä—Ç–æ—Ä–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ.</p>
      {% endif %}
    </form>

    <div class="text-center mt-4">
      <a href="{{ url_for('add_inverter') }}" class="btn btn-primary">‚ûï –î–æ–¥–∞—Ç–∏ —ñ–Ω–≤–µ—Ä—Ç–æ—Ä</a>
    </div>
  </div>

  <script>
    const checkboxes = document.querySelectorAll('input[name="selected_ids"]');
    const actions = document.getElementById('actions');

    checkboxes.forEach(cb => {
      cb.addEventListener('change', () => {
        const anyChecked = Array.from(checkboxes).some(c => c.checked);
        actions.style.display = anyChecked ? 'block' : 'none';
      });
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
